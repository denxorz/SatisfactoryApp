@using MudBlazor
@using SatisfactoryApp.Services
@using SatisfactoryApp.Services.Stations

@implements IDisposable
@inject StationStore StationStore

<MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
    <MudCardHeader Class="mud-primary pa-0 pl-1">
        <MudText Class="primary-card-header-title">Station Filters</MudText>
    </MudCardHeader>
    <MudCardContent Class="pa-2">
        <MudGrid Spacing="1">
            <MudItem xs="12" sm="6">
                <MudTextField @bind-Value="StationStore.SearchText"
                              Label="Search Stations" 
                              Variant="Variant.Outlined" 
                              Adornment="Adornment.Start" 
                              AdornmentIcon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.Search"
                              Immediate="true"
                              Clearable="true" />
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudComboBox T="CargoTypeOption"
                             @bind-SelectedValues="@StationStore.SelectedCargoTypes"
                             Variant="Variant.Outlined"
                             MultiSelection
                             Label="Cargo"
                             Editable
                             Clearable
                             SelectAll
                             ShowCheckbox>
                    @foreach (var item in StationStore.CargoTypeOptions)
                    {
                        <MudComboBoxItem Value="@item" Text="@item.ToString()"></MudComboBoxItem>
                    }
                </MudComboBox>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudChipSet @bind-SelectedValues="StationStore.SelectedTransferTypes"
                            SelectionMode="SelectionMode.MultiSelection" 
                            Color="Color.Primary">
                    <MudChip Value="@("Load")" Icon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.Input" />
                    <MudChip Value="@("Unload")" Icon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.Output" />
                    <MudChip Value="@("Uploader")" Icon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.CloudUpload" />
                </MudChipSet>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudChipSet @bind-SelectedValues="StationStore.SelectedStationTypes"
                            SelectionMode="SelectionMode.MultiSelection"
                            Color="Color.Primary">
                    <MudChip Value="@("Train")" Icon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.Train" />
                    <MudChip Value="@("Truck")" Icon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.LocalShipping" />
                    <MudChip Value="@("Drone")" Icon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.Flight" />
                </MudChipSet>
            </MudItem>
        </MudGrid>
    </MudCardContent>
</MudCard>

@code {
    private List<CargoTypeOption> CargoTypeOptions = [];

    protected override void OnInitialized()
    {
        StationStore.StationsChanged += OnChanged;
        Load();
    }

    private void OnChanged()
    {
        Load();
        StateHasChanged();
    }

    private void Load()
    {
        CargoTypeOptions = StationStore.CargoTypeOptions;
    }

    public void Dispose()
    {
        StationStore.StationsChanged -= OnChanged;
    }
}
