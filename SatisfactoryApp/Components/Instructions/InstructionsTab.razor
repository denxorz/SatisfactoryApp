@using Microsoft.AspNetCore.WebUtilities
@using MudBlazor
@using SatisfactoryApp.Services
@using SatisfactoryApp.Services.Stations

@inject NavigationManager NavigationManager

<MudGrid Spacing="3">
    <MudItem xs="12">
        <MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
            <MudCardHeader Class="mud-primary pa-0 pl-1">
                <MudText Class="primary-card-header-title" Color="Color.Surface">Instructions</MudText>
            </MudCardHeader>
            <MudCardContent Class="pa-3">
                Welcome to Stats of your Satisfactory! This tool helps you analyze your factories and get the most out of them.<br />
                <br />
                Listed below are some expectations the current version of the tool uses.<br />
                <br />
                <MudButton Variant="Variant.Outlined" 
                           Color="Color.Primary" 
                           StartIcon="@MudBlazor.FontIcons.MaterialSymbols.Outlined.PlayArrow"
                           OnClick="LoadExampleData"
                           Style="margin-top: 8px;">
                    Show me an example save game!
                </MudButton>
                <br />
                <br />
                Thanks for using the tool and happy building!
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12">
        <MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
            <MudCardHeader Class="mud-primary pa-0 pl-1">
                <MudText Class="primary-card-header-title" Color="Color.Surface">1. The station names follow a convention "name [in/out amount type]"</MudText>
            </MudCardHeader>
            <MudCardContent Class="pa-3">
                Examples: "Iron Ore Mine [out 500 iron]" "Rockets [out 5 TBR]".<br />
                The type will be fuzzy matched on the types of the content of the station. If the station is empty, a fuzzy match is done on all possible types.<br />
                If the in/out amount is not stable, it can be prefixed with a ~. For example: "Wires [out ~50 QuickWire]"<br />
                This applies to Train/Truck/Drone stations.<br />
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12">
        <MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
            <MudCardHeader Class="mud-primary pa-0 pl-1">
                <MudText Class="primary-card-header-title" Color="Color.Surface">2. Stations for the same factory are grouped together</MudText>
            </MudCardHeader>
            <MudCardContent Class="pa-3">
                Example: "MyFactory [out 5 Circuits]" "MyFactory [in 300 Rubber]" are grouped into a station called "MyFactory".<br />
                This applies to Train/Truck/Drone stations and mixes of them.<br />
                <br />
                <MudPaper Elevation="2" Class="pa-2" Style="border: 2px solid var(--mud-palette-divider); display: inline-block;">
                    <img src="/images/statis1-Page-1.drawio.png" alt="Instructions Page 1" style="width: 100%; height: auto; max-width: 600px; display: block;" />
                </MudPaper>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12">
        <MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
            <MudCardHeader Class="mud-primary pa-0 pl-1">
                <MudText Class="primary-card-header-title" Color="Color.Surface">3. Vehicles can load from multiple stations, but can only unload at one</MudText>
            </MudCardHeader>
            <MudCardContent Class="pa-3">
                This applies to Train/Truck/Drone stations.<br />
                <br />
                <MudPaper Elevation="2" Class="pa-2" Style="border: 2px solid var(--mud-palette-divider); display: inline-block;">
                    <img src="/images/statis1-Page-2.drawio.png" alt="Instructions Page 2" style="width: 100%; height: auto; max-width: 600px; display: block;" />
                </MudPaper>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12">
        <MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
            <MudCardHeader Class="mud-primary pa-0 pl-1">
                <MudText Class="primary-card-header-title" Color="Color.Surface">4. Power circuits are split to see which factories are stable</MudText>
            </MudCardHeader>
            <MudCardContent Class="pa-3">
                Each factory has its own power circuit. This is to check whether the factory as a whole runs stable (at 100%). All machines are tuned exactly to run at 100% stability.<br />
                In this way it's possible to see which factories are unstable, based on: <MudLink Href="https://www.youtube.com/watch?v=FnHyzwEPBeA" Target="_blank">https://www.youtube.com/watch?v=FnHyzwEPBeA</MudLink> <br />
                <br />
                <MudPaper Elevation="2" Class="pa-2" Style="border: 2px solid var(--mud-palette-divider); display: inline-block;">
                    <img src="/images/Screenshot%202025-12-09%20224904.png" alt="Power Circuit Screenshot" style="width: 100%; height: auto; max-width: 600px; display: block;" />
                </MudPaper>
            </MudCardContent>
        </MudCard>
    </MudItem>
    <MudItem xs="12">
        <MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
            <MudCardHeader Class="mud-primary pa-0 pl-1">
                <MudText Class="primary-card-header-title" Color="Color.Surface">5. Power circuits are named after the B side of the switch</MudText>
            </MudCardHeader>
            <MudCardContent Class="pa-3">
                When a circuit is attached to a Switch, the circuit attached the B side will get the name of the switch.<br />
                <br />
                <MudPaper Elevation="2" Class="pa-2" Style="border: 2px solid var(--mud-palette-divider); display: inline-block;">
                    <img src="/images/statis1-5. circuit names.drawio.png" alt="Instructions Page 2" style="width: 100%; height: auto; max-width: 600px; display: block;" />
                </MudPaper>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>

@code {
    private void LoadExampleData()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        var queryParams = QueryHelpers.ParseQuery(uri.Query);
        
        var basePath = uri.GetLeftPart(UriPartial.Path);
        var newQuery = QueryHelpers.AddQueryString(basePath, "example", "true");
        
        if (queryParams.Count > 0)
        {
            foreach (var param in queryParams)
            {
                if (param.Key != "example")
                {
                    newQuery = QueryHelpers.AddQueryString(newQuery, param.Key, param.Value.ToString());
                }
            }
        }
        
        NavigationManager.NavigateTo(newQuery);
    }
}

