@using SatisfactoryApp.Services
@using MudBlazor
@inject ResourceStore ResourceStore

<MudCard Outlined="true" Square="true" Class="border-solid border-4 mud-border-primary">
    <MudCardHeader Class="mud-primary pa-0 pl-1">
        <MudText Class="primary-card-header-title">Resource Filters</MudText>
    </MudCardHeader>
    <MudCardContent Class="pa-2">
        <MudGrid Spacing="1">
            <MudItem xs="12" sm="6" md="4">
                <MudComboBox T="ResourceTypeOption"
                             @bind-SelectedValues="@ResourceStore.SelectedResourceTypes"
                             Variant="Variant.Outlined"
                             MultiSelection
                             Label="Type"
                             Editable
                             Clearable
                             SelectAll
                             ShowCheckbox>
                    @foreach (var item in ResourceTypeOptions)
                    {
                        <MudComboBoxItem Value="@item" Text="@item.ToString()"></MudComboBoxItem>
                    }
                </MudComboBox>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudChipSet T="LeftoverRangeOption"
                            @bind-SelectedValues="ResourceStore.SelectedLeftoverRanges"
                            SelectionMode="SelectionMode.MultiSelection"
                            Color="Color.Primary">
                    @foreach (var range in ResourceStore.AllLeftoverOptions)
                    {
                        <MudChip Value="@range">@range.Title</MudChip>
                    }
                </MudChipSet>
            </MudItem>
            <MudItem xs="12" sm="6" md="4">
                <MudChipSet T="int"
                            @bind-SelectedValues="ResourceStore.SelectedMaxValues"
                            SelectionMode="SelectionMode.MultiSelection"
                            Color="Color.Primary">
                    <MudChip Value="300">Max 300</MudChip>
                    <MudChip Value="600">Max 600</MudChip>
                    <MudChip Value="1200">Max 1200</MudChip>
                </MudChipSet>
            </MudItem>
        </MudGrid>
    </MudCardContent>
</MudCard>

@code {
    private List<ResourceTypeOption> ResourceTypeOptions = [];

    protected override void OnInitialized()
    {
        ResourceStore.ResourcesChanged += OnChanged;
        Load();
    }

    private void OnChanged()
    {
        Load();
        StateHasChanged();
    }

    private void Load()
    {
        ResourceTypeOptions = ResourceStore.ResourceTypeOptions;
    }
}

